<?xml version="1.0" encoding="UTF-8"?>
<bpws:process name="ToyWorkflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://docs.oasis-open.org/wsbpel/2.0/process/executable http://docs.oasis-open.org/wsbpel/2.0/OS/process/executable/ws-bpel_executable.xsd"
 xmlns:bpws="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
 xmlns:ns0="http://eclipse.org/bpel/sample"
 xmlns:ns1="http://first.cagrid.org/First"
 xmlns:ns="http://eclipse.org/bpel/sampleArtifacts"
 xmlns:ns2="http://second.cagrid.org/Second"
 targetNamespace="http://org.cagrid.workflow.manager.sytem.tests"
 exitOnStandardFault="yes">
    <bpws:import importType="http://schemas.xmlsoap.org/wsdl/"
        location="ToyWorkflowArtifacts.wsdl" namespace="http://eclipse.org/bpel/sampleArtifacts"/>
    <bpws:import importType="http://www.w3.org/2001/XMLSchema"
        location="../First/schema/First/First.wsdl" namespace="http://first.cagrid.org/First"/>
    <bpws:import importType="http://schemas.xmlsoap.org/wsdl/"
        location="../Second/schema/Second/Second.wsdl" namespace="http://second.cagrid.org/Second"/>
    <bpws:import importType="http://schemas.xmlsoap.org/wsdl/"
        location="ToyWorkflow.wsdl" namespace="http://eclipse.org/bpel/sample"/>
    <bpws:partnerLinks>
        <bpws:partnerLink name="userInput" partnerLinkType="ns:ToyWorkflowInput"/>
        <bpws:partnerLink myRole="firstService" name="firstInvoke" partnerLinkType="ns:firstLinkType"/>
        <bpws:partnerLink myRole="invoker" name="secondInvoke" partnerLinkType="ns:secondServiceInvocation"/>
        <bpws:partnerLink myRole="ToyWorkflowOutput" name="replyUser" partnerLinkType="ns:ToyWorkflowResponse"/>
        <bpws:partnerLink name="firstInvoke" partnerLinkType="ns:firstLinkType"/>
        <bpws:partnerLink name="secondInvoke" partnerLinkType="ns:secondServiceInvocation"/>
    </bpws:partnerLinks>
    <bpws:variables>
        <bpws:variable name="Request"/>
        <bpws:variable element="ns1:PrintRequest" name="firstRequest"/>
        <bpws:variable element="ns1:PrintResponse" name="firstResponse"/>
        <bpws:variable element="ns2:ReceiveRequest" name="secondrequest"/>
        <bpws:variable name="secondResponse" element="ns2:ReceiveResponse" />
        <bpws:variable name="Response"/>
        <bpws:variable messageType="ns0:ToyWorkflowResponseMessage" name="replyUserResponse"/>
    </bpws:variables>
    <bpws:sequence name="main">
        <bpws:receive name="Receive" partnerLink="userInput" variable="Request" operation="receiveFromUser"/>
        <bpws:assign name="userToFirst" validate="no">
            <bpws:copy>
                <bpws:from variable="Request"/>
                <bpws:to variable="firstRequest"/>
            </bpws:copy>
        </bpws:assign>
        <bpws:invoke inputVariable="firstRequest" name="first" operation="ns1:print"
            outputVariable="firstResponse" partnerLink="firstInvoke"/>
        <bpws:assign name="firstToSecond" validate="no">
            <bpws:copy>
                <bpws:from variable="firstResponse">
                    <bpws:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[/ns1:response]]></bpws:query>
                </bpws:from>
                <bpws:to variable="secondrequest">
                    <bpws:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[/ns2:input]]></bpws:query>
                </bpws:to>
            </bpws:copy>
        </bpws:assign>
        <bpws:invoke inputVariable="secondrequest" name="second" operation="ns2:receive"
            outputVariable="secondResponse" partnerLink="secondInvoke"/>
        <bpws:assign name="secondToUser" validate="no">
            <bpws:copy>
                <bpws:from variable="secondResponse"/>
                <bpws:to variable="Response"/>
            </bpws:copy>
        </bpws:assign>
        <bpws:reply name="Reply" operation="onResult"
            partnerLink="replyUser" portType="ns0:ToyWorkflowCallback" variable="replyUserResponse"/>
    </bpws:sequence>
</bpws:process>
