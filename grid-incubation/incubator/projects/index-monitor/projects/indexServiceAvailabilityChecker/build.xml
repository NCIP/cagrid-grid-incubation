<?xml version="1.0"?>

<!-- ================================================================= -->
<!-- Index Service Deploy build file                                   -->
<!-- ================================================================= -->

<project name="IndexServiceAvailabilityChecker" default="compile" basedir=".">
	<property name="project.version" value="1.0"/>


	<!-- Define the environment variable -->
	<property environment="env" />

	<!-- Important directories and files -->
	<property name="src.dir" location="src" />
	<property name="lib.dir" location="lib" />
	<property name="jars.dir" location="ext/dependencies/default/jars"/>


	<!-- Basic Build directories -->

	<!-- Auxiliary directory where all the intermediate files will be placed -->
	<property name="build.dir" location="build" />
	<!-- Directory for compiled service classes -->
	<property name="build.dest" location="${build.dir}/classes" />

	<!-- - - - - - - - - - - - - - - - - - 
          target: setJBossProperty                      
         - - - - - - - - - - - - - - - - - -->
    <target name="setJBossProperty">
		<fail unless="env.JBOSS_HOME"
			  message="Cannot deploy to JBOSS unless environment variable JBOSS_HOME is defined" />
    	<property name="deploy.dir" location="env.JBOSS_HOME"/>
    </target>


	<!-- ============================================================== -->
	<!-- Globus properties                                              -->
	<!-- ============================================================== -->
	<target name="checkGlobus" depends="setGlobus">
		<condition property="globus.not.found">
			<or>
				<not>
					<isset property="ext.globus.dir" />
				</not>
				<equals arg1="${ext.globus.dir}" arg2="" />
			</or>
		</condition>
		<fail message="Globus installation is not set in either GLOBUS_LOCATION or ext.globus.dir" if="globus.not.found" />
		<echo message="Globus: ${ext.globus.dir}" />
	</target>
	<target name="setGlobus" if="env.GLOBUS_LOCATION">
		<!-- GT4 build files and directories-->
		<property name="ext.globus.dir" value="${env.GLOBUS_LOCATION}" />
		<property name="build.stubs" location="build-stubs.xml" />
		<property name="schema.src" location="${ext.globus.dir}/share/schema" />
		<property name="build.packages" location="${ext.globus.dir}/share/globus_wsrf_common/build-packages.xml" />
		<!-- Copied from build.stubs file, as there is no way to "append" to the value in the remote file -->
		<property name="GT4.ns.excludes" value="-x http://docs.oasis-open.org/wsrf/2004/06/wsrf-WS-BaseFaults-1.2-draft-01.xsd -x http://docs.oasis-open.org/wsrf/2004/06/wsrf-WS-BaseFaults-1.2-draft-01.wsdl -x http://docs.oasis-open.org/wsrf/2004/06/wsrf-WS-ResourceLifetime-1.2-draft-01.xsd -x http://docs.oasis-open.org/wsrf/2004/06/wsrf-WS-ResourceLifetime-1.2-draft-01.wsdl -x http://docs.oasis-open.org/wsrf/2004/06/wsrf-WS-ResourceProperties-1.2-draft-01.xsd -x http://docs.oasis-open.org/wsrf/2004/06/wsrf-WS-ResourceProperties-1.2-draft-01.wsdl -x http://docs.oasis-open.org/wsrf/2004/06/wsrf-WS-ServiceGroup-1.2-draft-01.xsd -x http://docs.oasis-open.org/wsrf/2004/06/wsrf-WS-ServiceGroup-1.2-draft-01.wsdl -x http://docs.oasis-open.org/wsn/2004/06/wsn-WS-BaseNotification-1.2-draft-01.xsd -x http://docs.oasis-open.org/wsn/2004/06/wsn-WS-BaseNotification-1.2-draft-01.wsdl -x http://schemas.xmlsoap.org/ws/2004/04/trust -x http://schemas.xmlsoap.org/ws/2002/12/policy -x http://schemas.xmlsoap.org/ws/2002/07/utility -x http://schemas.xmlsoap.org/ws/2004/04/sc -x http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd -x http://www.w3.org/2000/09/xmldsig# -x http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd -x http://schemas.xmlsoap.org/ws/2004/09/enumeration" />
	</target>
	
	<!-- - - - - - - - - - - - - - - - - - 
          target: _cleanDeploy                      
         - - - - - - - - - - - - - - - - - -->
    <target name="_cleanDeploy" if="availabilityChecker.deploy.dir">
        <delete dir="${availabilityChecker.deploy.dir}"/>
    </target>

	
	<!-- ================================= 
          target: clean              
         ================================= -->
    <target name="clean" description="Remove artifacts created by previous builds.">
        <delete dir="${build.dir}" />
    </target>


	<!-- Sets up the build directory structure -->
	<target name="init" depends="checkGlobus">
		<mkdir dir="${build.dir}" />
		<mkdir dir="${build.dest}" />
	</target>

	<!-- - - - - - - - - - - - - - - - - - 
          target: compile                      
         - - - - - - - - - - - - - - - - - -->
	<target name="compile" depends="init" description="Compile the java code.">
		<javac srcdir="${src.dir}" includes="**" destdir="${build.dest}" debug="${java.debug}">
			<classpath>
				<fileset dir="${lib.dir}">
					<include name="*.jar"/>
				</fileset>				<fileset dir="${jars.dir}">
					<include name="*.jar"/>
				</fileset>
				<fileset dir="${ext.globus.dir}/lib">
					<include name="**/*.jar" />
	                <exclude name="junit.jar"/>
				</fileset>
			</classpath>
		</javac>
	</target>
	
	<!-- ================================= 
          target: deploy              
         ================================= -->
    <target name="deploy" depends="clean,compile" description="Copy this directory to the destination directory">
        <fail unless="availabilityChecker.deploy.dir" message="Deployment of the IndexServiceAvailabilityChecker must be done as part of the index-monitor deployment."/>
    	<copy todir="${availabilityChecker.deploy.dir}" overwrite="true">
    		<fileset dir="${basedir}"/>
    	</copy>
    </target>
</project>