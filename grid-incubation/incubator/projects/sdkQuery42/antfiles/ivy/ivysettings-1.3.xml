<?xml version="1.0" encoding="UTF-8"?>
<ivysettings>
  <settings defaultResolver="caGrid-incubator-ivy-resolver" circularDependencyStrategy="error"/>
  <!--
    TODO: I had to set checkUpToDate="false" so target grids would resolve properly...
    The cache was correct, but it was not copying artificats to projects if the previous date was newer than the new date
    It should retrieve the necessary version regardless of the date... not sure why it does that.
  -->

  <caches checkUpToDate="false" default="cache1.3" useOrigin="true">
  	<cache name="cache1.3" basedir="${user.dir}/.cache1.3"/>
  </caches>

  <macrodef name="cagrid-incubator-fs-resolver">
    <attribute name="repo.dir"/>
    <filesystem name="fs" local="true">
      <ivy pattern="@{repo.dir}/[organisation]/[module]/ivy-[revision].xml"/>
      <artifact pattern="@{repo.dir}/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]"/>
      <artifact pattern="@{repo.dir}/[organisation]/[module]/[revision]/[artifact][revision].[ext]"/>
      <artifact pattern="@{repo.dir}/[organisation]/[module]/[revision]/[artifact].[ext]"/>
    </filesystem>
  </macrodef>
  <macrodef name="cagrid-fs-resolver">
    <attribute name="repo.dir"/>
    <filesystem name="fs" local="true">
      <ivy pattern="@{repo.dir}/[organisation]/[module]/ivy-[revision].xml"/>
      <artifact pattern="@{repo.dir}/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]"/>
      <artifact pattern="@{repo.dir}/[organisation]/[module]/[revision]/[artifact].[ext]"/>
    </filesystem>
  </macrodef>
  <resolvers>
    <chain name="caGrid-incubator-ivy-resolver" returnFirst="true">
      <!-- Try the developer's local caGrid integration repository-->
      <cagrid-fs-resolver repo.dir="${integration.repository.dir}" name="caGrid-local-integration-fs"/>

	  <!-- Last, use the caGrid 1.3 repository 
	  <url name="remote-caGrid-ivy-resolver-1.3" cache="cache1.3">
		<ivy pattern="http://software.cagrid.org/repository-1.3/[organisation]/[module]/ivy-[revision].xml"/>
		<artifact pattern="http://software.cagrid.org/repository-1.3/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]"/>
		<artifact pattern="http://software.cagrid.org/repository-1.3/[organisation]/[module]/[revision]/[artifact].[ext]"/>
	  </url>
	  -->
	  
	  <!-- caGrid 1.3.0.2 (pre) release repositories --> 
	  <url name="remote-caGrid-ivy-resolver-1.3.0.2-repository" cache="cache1.3">
		<ivy pattern="http://quality.cagrid.org/job/caGrid-1.3.0.2-Release/lastStableBuild/artifact/caGrid/repository/[organisation]/[module]/ivy-[revision].xml"/>
		<artifact pattern="http://quality.cagrid.org/job/caGrid-1.3.0.2-Release/lastStableBuild/artifact/caGrid/repository/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]"/>
		<artifact pattern="http://quality.cagrid.org/job/caGrid-1.3.0.2-Release/lastStableBuild/artifact/caGrid/repository/[organisation]/[module]/[revision]/[artifact].[ext]"/>
	  </url>
	  <url name="remote-caGrid-ivy-resolver-1.3.0.2-integration-repository" cache="cache1.3">
		<ivy pattern="http://quality.cagrid.org/job/caGrid-1.3.0.2-Release/lastStableBuild/artifact/caGrid/integration-repository/[organisation]/[module]/ivy-[revision].xml"/>
		<artifact pattern="http://quality.cagrid.org/job/caGrid-1.3.0.2-Release/lastStableBuild/artifact/caGrid/integration-repository/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]"/>
		<artifact pattern="http://quality.cagrid.org/job/caGrid-1.3.0.2-Release/lastStableBuild/artifact/caGrid/integration-repository/[organisation]/[module]/[revision]/[artifact].[ext]"/>
	  </url>
	  
    </chain>
  </resolvers>
</ivysettings>
